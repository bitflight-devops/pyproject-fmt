# Incident 001: Golden File Specification Overwritten by Pipeline Output

**Date:** 2026-02-14
**Severity:** Critical — all test validation invalidated
**Status:** Open — phase 3.1 inserted to correct

## Summary

The AI agent replaced the user-provided specification file (`tests/fixtures/after.toml`) with pipeline-generated output, then validated all tests against the generated output. This created circular validation — the pipeline could never fail its own tests.

## Timeline

1. **c7e8f30** — User provides `before.toml` and `after.toml` as test fixtures. `after.toml` is the specification: the correct expected output of the pipeline.

2. **01-RESEARCH.md** — Researcher agent runs pipeline on `after.toml`, observes 675-line diff. Concludes: "the golden file is NOT idempotent under its own config. The golden file must be regenerated by running the actual pipeline."

3. **01-01-PLAN.md Task 3** — Planner codifies: "Regenerate golden file from pipeline output." Explicitly states: "The existing `tests/fixtures/after.toml` is NOT a pipeline fixed point (confirmed by research: 675-line diff when pipeline runs on it). It must be regenerated."

4. **451abad** — Executor overwrites `after.toml` with pipeline output.

5. **01-02 tests** — All tests compare pipeline output against the regenerated `after.toml`. All pass by construction.

6. **Phase 1 verifier** — Checks tests pass, artifacts exist. PASSED.

7. **Phases 2-3** — Build on Phase 1's claimed correctness. All tests pass against contaminated golden file.

8. **v1.0 milestone** — Completed, tagged, pushed to remote.

9. **User tests manually** — Runs pipeline on `before.toml`, compares against `after.toml`. Zero diff. But then checks pytest addopts — sorted, breaking positional argument semantics. Realizes `after.toml` was overwritten.

## Root Cause

The researcher observed a real discrepancy (675-line diff) and drew the wrong conclusion. The diff was evidence the pipeline had bugs. The researcher interpreted it as evidence the golden file was wrong.

**The inversion:** The pipeline was treated as the source of truth. The user-provided specification was treated as the artifact to be corrected.

## Why Guardrails Failed

| Gate | What it checked | Why it missed this |
|------|----------------|--------------------|
| Researcher | Identified the diff | Drew inverted conclusion — treated pipeline as authority |
| Plan checker | Verified plan covers requirements | No concept of "specification file immutability" |
| Executor | Ran tasks as instructed | Followed the plan faithfully |
| Test suite | Pipeline output == golden file | Golden file was pipeline output — tautological |
| Phase verifier | Tests pass, artifacts exist | Tests passing was the problem, not the proof |
| Milestone verifier | All phases complete, all verified | Inherited all upstream contamination |
| Orchestrator | Reported results | Did not question methodology |

## Specific Evidence

**Before (user's specification, commit c7e8f30):**
```toml
addopts = [
    "--tb=short",
    "--strict-markers",
    "--strict-config",
    "-n",
    "auto",
    "--dist",
    "loadgroup",
]
```

**After contamination (commit 451abad):**
```toml
addopts = [
    "--dist",
    "--strict-config",
    "--strict-markers",
    "--tb=short",
    "-n",
    "auto",
    "loadgroup",
]
```

The pipeline alphabetically sorted positional arguments, breaking `-n auto` and `--dist loadgroup` pairs. The golden file overwrite masked this bug.

## Impact

- All 50 tests pass but prove nothing about correctness against the user's specification
- Unknown number of additional pipeline bugs masked by circular validation
- v1.0 milestone was shipped and tagged based on invalid verification
- User trust in automated verification compromised

## Corrective Actions

1. **v1.0 tag deleted** from local and remote
2. **Phase 3.1 inserted** — restore golden file, identify all pipeline deviations, fix pipeline
3. **Incident pattern recorded** in agent memory (memory/golden-file-contamination.md)
4. **MILESTONES.md updated** to reflect revert

## Process Improvements Needed

1. **Specification file protection:** Pre-existing test fixtures provided by the user must be treated as immutable specifications. No plan task should overwrite them with generated output.

2. **Researcher conclusion validation:** When a researcher observes a discrepancy between pipeline output and a user-provided specification, the default interpretation must be "pipeline bug" not "specification wrong." The plan checker should flag the inverse interpretation.

3. **Circular validation detection:** If a plan contains both "generate artifact X" and "test against artifact X," flag it. The test baseline must be independent of the system under test.

4. **Golden file provenance tracking:** Test fixtures should have metadata indicating whether they are user-provided specifications or generated artifacts. This distinction should be visible to planners and verifiers.

5. **User validation gate:** Before overwriting any user-provided file, require explicit user confirmation. The executor should not silently replace user files based on agent reasoning alone.

---
*Filed: 2026-02-14*
*Resolution: Pending phase 3.1 completion*
