[project]
name = "claude-linting-hook"
description = "A robust, fully portable Claude Code hook that automatically detects project configuration and applies appropriate linting tools based on modified files."
readme = "README.md"
dynamic = ["version"]
authors = [{ name = "Jamie Nelson", email = "jamie.nelson@assaabloy.com" }]
maintainers = [{ name = "Jamie Nelson", email = "jamie.nelson@assaabloy.com" }]
license = { text = "MIT" }
classifiers = [
    "Development Status :: 4 - Beta",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Topic :: Software Development :: Libraries",
    "Topic :: Software Development :: Quality Assurance",
]
keywords = [
    "claude",
    "linting",
    "hook",
    "automation",
    "code",
    "quality",
    "assurance",
]
requires-python = ">=3.11,<3.14"
dependencies = [
    "basedpyright>=1.37.4",
    "gitpython>=3.1.45",
    "mypy>=1.19.1",
    "ruff>=0.15.0",
    "ty>=0.0.15",
    "typer>=0.21.1",
]

[project.scripts]
claude-lint-hook = "claude_lint_hook.main:main"

[project.urls]
"Bug Tracker" = "https://sourcery.assaabloy.net/jamnel/claude-linting-hook/-/issues"
Documentation = "https://sourcery.assaabloy.net/jamnel/claude-linting-hook/-/blob/main/README.md"
Homepage = "https://sourcery.assaabloy.net/jamnel/claude-linting-hook"
Repository = "https://sourcery.assaabloy.net/jamnel/claude-linting-hook"

[build-system]
requires = ["hatch-vcs", "hatchling"]
build-backend = "hatchling.build"

[dependency-groups]
dev = [
    "generate-changelog>=0.16.0",
    "hatch-vcs>=0.5.0",
    "hatchling>=1.27.0",
    "pep723-loader>=0.7.0",
    "prek>=0.3.2",
    "pytest-asyncio>=1.3.0",
    "pytest-cov>=7.0.0",
    "pytest-mock>=3.15.1",
    "pytest-xdist>=3.8.0",
    "pytest>=9.0.2",
    "python-dotenv>=1.2.1",
    "tiktoken>=0.12.0",
    "toml-sort>=0.24.3",
    "uv-sort>=0.7.0",
]

[tool.hatch.build.targets.sdist]
include = ["claude_lint_hook.py", "pyproject.toml", "README.md"]

[tool.hatch.build.targets.sdist.hooks.custom]
path = "scripts/hatch_build.py"

[tool.hatch.build.targets.wheel]
include = ["claude_lint_hook.py"]

[tool.hatch.version]
source = "vcs"

[tool.git-cliff]
config = "cliff.toml"

[tool.uv]

[[tool.uv.index]]
default = true
name = "pypi"
url = "https://pypi.org/simple"

[[tool.uv.index]]
default = false
explicit = true
name = "gitlab"
url = "https://sourcery.assaabloy.net/api/v4/groups/aehgfw/-/packages/pypi/simple"

[tool.pytest.ini_options]
addopts = [
    "--tb=short",
    "--strict-markers",
    "--strict-config",
    "-n",
    "auto",
    "--dist",
    "loadgroup",
]
markers = [
    "demos: marks tests as demonstration tests",
    "e2e: marks tests as end-to-end tests",
    "integration: marks tests as integration tests",
    "slow: marks tests as slow (deselect with '-m \"not slow\"')",
    "unit: marks tests as unit tests",
]
pythonpath = ["."]
testpaths = ["tests"]

[tool.ty.environment]
root = ["./"]

[[tool.ty.overrides]]
include = ["**/test_*.py", "tests/**"]

[tool.ty.overrides.rules]
invalid-argument-type = "warn"
invalid-assignment = "warn"
possibly-unresolved-reference = "warn"
unresolved-attribute = "warn"

[tool.ty.src]
include = ["**/*.py", "*.py"]

[tool.ruff]
fix = true
line-length = 120
src = [".gitlab", "packages", "scripts", "tests", "typings"]
target-version = "py311"
unsafe-fixes = true

[tool.ruff.format]
docstring-code-format = true
line-ending = "lf"
preview = true
quote-style = "double"
skip-magic-trailing-comma = true

[tool.ruff.lint]
extend-select = [
    "A",     # see: https://docs.astral.sh/ruff/rules/#flake8-builtins-a
    "ANN",   # see: https://docs.astral.sh/ruff/rules/#flake8-annotations-ann
    "ASYNC", # see: https://docs.astral.sh/ruff/rules/#flake8-async-async
    "B",     # see: https://docs.astral.sh/ruff/rules/#flake8-bugbear-b
    "BLE",   # see: https://docs.astral.sh/ruff/rules/#flake8-blind-except-ble
    "C4",    # see: https://docs.astral.sh/ruff/rules/#flake8-comprehensions-c4
    "C90",   # see: https://docs.astral.sh/ruff/rules/#mccabe-c90
    "D",     # see: https://docs.astral.sh/ruff/rules/#pydocstyle-d
    "DOC",   # see: https://docs.astral.sh/ruff/rules/#pydoclint-doc
    "E",     # see: https://docs.astral.sh/ruff/rules/#error-e
    "EXE",   # see: https://docs.astral.sh/ruff/rules/#flake8-executable-exe
    "F",     # see: https://docs.astral.sh/ruff/rules/#pyflakes-f
    "FA",    # see: https://docs.astral.sh/ruff/rules/#flake8-annotations-fa
    "FAST",  # see: https://docs.astral.sh/ruff/rules/#fastapi-fast
    "FLY",   # see: https://docs.astral.sh/ruff/rules/#flynt-fly
    "FURB",  # see: https://docs.astral.sh/ruff/rules/#refurb-furb
    "G201",  # see: https://docs.astral.sh/ruff/rules/logging-exc-info/
    "G202",  # see: https://docs.astral.sh/ruff/rules/logging-redundant-exc-info/
    "I",     # see: https://docs.astral.sh/ruff/rules/#isort-i
    "N",     # see: https://docs.astral.sh/ruff/rules/#flake8-quotes-n
    "PERF",  # see: https://docs.astral.sh/ruff/rules/#perflint-perf
    "PGH",   # see: https://docs.astral.sh/ruff/rules/#pygrep-hooks-pgh
    "PIE",   # see: https://docs.astral.sh/ruff/rules/#flake8-pie-pie
    "PL",    # see: https://docs.astral.sh/ruff/rules/#pyflakes-f
    "PT",    # see: https://docs.astral.sh/ruff/rules/#flake8-pytest-style-pt
    "PTH",   # see: https://docs.astral.sh/ruff/rules/#flake8-use-pathlib-pth
    "PYI",   # see: https://docs.astral.sh/ruff/rules/#flake8-pyi-pyi
    "Q",     # see: https://docs.astral.sh/ruff/rules/#flake8-quotes-q
    "RET",   # see: https://docs.astral.sh/ruff/rules/#flake8-return-ret
    "RSE",   # see: https://docs.astral.sh/ruff/rules/#flake8-raise-rse
    "RUF",   # see: https://docs.astral.sh/ruff/rules/#ruff-ruf
    "S",     # see: https://docs.astral.sh/ruff/rules/#flake8-bandit-s
    "SIM",   # see: https://docs.astral.sh/ruff/rules/#flake8-simplify-sim
    "SLF",   # see: https://docs.astral.sh/ruff/rules/#flake8-self-slf
    "SLOT",  # see: https://docs.astral.sh/ruff/rules/#flake8-slots-slot
    "T10",   # see: https://docs.astral.sh/ruff/rules/#flake8-debugger-t10
    "T20",   # see: https://docs.astral.sh/ruff/rules/#flake8-typing-t20
    "TC",    # see: https://docs.astral.sh/ruff/rules/#flake8-type-checking-tc
    "TRY",   # see: https://docs.astral.sh/ruff/rules/#tryceratops-try
    "UP",    # see: https://docs.astral.sh/ruff/rules/#pyupgrade-up
    "W",     # see: https://docs.astral.sh/ruff/rules/#warning-w
    "YTT",   # see: https://docs.astral.sh/ruff/rules/#flake8-2020-ytt
]
ignore = [
    "COM812",  # Missing trailing comma
    "COM819",  # Missing trailing comma
    "D107",    # Missing docstring in __init__
    "D415",    # First line should end with a period
    "DOC501",  # Raised exception {id} missing from docstring
    "DOC502",  # Raised exception is not explicitly raised
    "E111",    # Indentation is not a multiple of four
    "E117",    # Over-indented for visual indent
    "E203",    # whitespace before ':'
    "E402",    # todo: use noqa per line
    "E501",    # Line length exceeds maximum limit
    "E501",    # Line too long ({width} > {limit})
    "EXE003",  # Shebang should contain python, pytest, or uv run (doesn't handle global arguments)
    "PLR0913", # Too many arguments - acceptable for internal APIs
    "PLR6301", # Method could be function - acceptable for API design
    "Q000",    # Remove bad quotes
    "Q001",    # Remove bad quotes
    "Q002",    # Remove bad quotes
    "Q003",    # Remove bad quotes
    "S310",
    "S404",    # subprocess possibly insecure - still need to use subprocess though
    "S603",    # subprocess without shell=True
    "S606",    # os.exec* without shell - intentional for privilege elevation (safer than with shell)
    "T201",    # print() statements are intentional for CI output visibility
    "TRY003",  # Exception message should not be too long
]
preview = true
unfixable = ["F401"]

[tool.ruff.lint.flake8-quotes]
docstring-quotes = "double"

[tool.ruff.lint.isort]
combine-as-imports = true
force-single-line = false
force-wrap-aliases = false
required-imports = ["from __future__ import annotations"]
split-on-trailing-comma = false

[tool.ruff.lint.mccabe]
max-complexity = 12

[tool.ruff.lint.per-file-ignores]
"**/scripts/**" = [
    "T201", # print() statements are intentional for CI output visibility
]
"**/tests/**" = [
    "ANN",  # Type annotations optional for test fixtures/methods
    "D",    # Docstring requirements relaxed for tests
    "DOC",  # Docstring content requirements relaxed
    "E501", # Line length relaxed for test data
    "EXE",  # Shebang executable check skipped for PEP723 test files
    "N",    # camelCase in test names acceptable when testing API fields
    "PLC",  # Local imports acceptable in test helpers
    "PLR",  # Testing private methods is valid test pattern
    "S",    # Security checks not needed in tests
    "SLF",  # Private name imports acceptable for testing internals
    "T",    # print() statements are intentional for CI output visibility
]
# Claude Code hook implementation has special constraints:
# - API response dataclasses must use camelCase to match Claude Code JSON protocol
"claude_lint_hook.py" = [
    "N815", # camelCase REQUIRED: Claude Hook API field names must match protocol
]
"typings/**" = ["A", "ANN", "N"]

[tool.ruff.lint.pycodestyle]
max-line-length = 120

[tool.ruff.lint.pydocstyle]
convention = "google"

[tool.mypy]
exclude = [".*"]

[tool.basedpyright]
typeCheckingMode = "off"

[tool.pylint.'MESSAGES CONTROL']
disable = """
    invalid-name,
    line-too-long,
    logging-fstring-interpolation,
    missing-class-docstring,
    missing-function-docstring,
    missing-module-docstring,
    unused-variable,
    wrong-import-position,
"""
max-line-length = 120

[tool.semantic_release]
allow_zero_version = true
build_command = "uv build"
major_on_zero = true
tag_format = "v{version}"
version_toml = []

[tool.semantic_release.branches.main]
match = "(main|master)"
prerelease = false

[tool.semantic_release.commit_parser_options]
allowed_tags = [
    "build",
    "chore",
    "ci",
    "docs",
    "feat",
    "fix",
    "perf",
    "refactor",
    "style",
    "test",
]
minor_tags = ["feat"]
patch_tags = ["fix", "perf", "refactor"]

[tool.tomlsort]
in_place = true
sort_table_keys = true
spaces_indent_inline_array = 4
trailing_comma_inline_array = true
sort_first = [
    "project",
    "project.*",
    "build-system",
    "dependency-groups",
    "tool.hatch",
    "tool.git-cliff",
    "tool.pypis_delivery_service",
    "tool.uv",
    "tool.pytest",
    "tool.coverage",
    "tool.ty",
    "tool.ruff",
    "tool.mypy",
    "tool.pyright",
    "tool.basedpyright",
    "tool.pylint",
    "tool.isort",
    "tool.black",
    "tool.semantic_release",
    "tool.*",
    "tool.tomlsort",
]

[tool.tomlsort.overrides."build-system"]
first = ["requires", "build-backend"]
inline_arrays = true

[tool.tomlsort.overrides."dependency-groups"]
inline_arrays = true

[tool.tomlsort.overrides."project"]
inline_arrays = true
first = [
    "name",
    "version",
    "description",
    "readme",
    "dynamic",
    "authors",
    "maintainers",
    "license",
    "classifiers",
    "keywords",
    "requires-python",
    "dependencies",
]

[tool.tomlsort.overrides."tool.pytest.*"]
inline_arrays = true

[tool.tomlsort.overrides."tool.ruff"]
inline_arrays = true

[tool.tomlsort.overrides."tool.ruff.*"]
inline_arrays = true

[tool.tomlsort.overrides."tool.semantic_release.commit_parser_options"]
inline_arrays = true

[tool.tomlsort.overrides."tool.tomlsort"]
table_keys = false
inline_arrays = false

[tool.tomlsort.overrides."tool.tomlsort.*"]
table_keys = false
inline_arrays = false

[tool.tomlsort.overrides."tool.ty"]
inline_arrays = true

[tool.tomlsort.overrides."tool.ty.*"]
inline_arrays = true

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "if __name__ == .__main__.:",
    "raise AssertionError",
    "raise NotImplementedError",
    "if TYPE_CHECKING:",
]
fail_under = 70
show_missing = true

[tool.coverage.run]
omit = ["tests/*", "*/tests/*", ".gitlab/scripts/*"]
source = ["claude_lint_hook.py"]
